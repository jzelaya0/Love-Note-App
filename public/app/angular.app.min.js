angular.module("loveNote",["appRoutes","mainCtrl"]).config(["$httpProvider",function(t){t.interceptor.push("AunthInterceptor")}]),angular.module("appRoutes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"app/views/templates/home.html"}),e.html5Mode(!0)}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","Auth",function(t,e,o){var n=this;n.loggedIn=o.isLoggedIn(),t.$on("$routeChangeStart",function(){n.loggedIn=o.isLoggedIn()}),o.getUser().success(function(t){n.user=t}),n.doLogin=function(){o.login(n.loginData.email,n.loginData.password).success(function(t){o.getUser().then(function(t){n.user=t.data}),e.path("/dashboard")})},n.doLogOut=function(){o.logout(),e.path("/")}}]),angular.module("authService",[]).factory("AuthToken",["$window",function(t){var e={};return e.getToken=function(){return t.localStorage.getItem("token")},e.setToken=function(e){e?t.localStorage.setItem("token",e):t.localStorage.removeItem("token")},e}]).factory("Auth",["$http","$q","AuthToken",function(t,e,o){var n={};return n.login=function(e,o){return t.post("/api/authenticate",{email:e,password:o})},n.logout=function(){o.setToken()},n.isLoggedIn=function(){return!!o.getToken()},n.getUser=function(){return o.getToken()?t.get("/api/me"):e.reject({message:"User does not have a token"})},authTokenFactory}]).factory("AunthInterceptor",["$q","$location","AuthToken",function(t,e,o){var n={};return n.request=function(t){var e=o.getToken();return e&&(t.headers["x-access-token"]=e),t},n.responseError=function(o){return 403==o.status&&e.path("/login"),t.reject(o)},n}]);